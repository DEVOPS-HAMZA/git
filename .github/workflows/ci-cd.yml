name: Continuous Integration and Continuous Deployment

on:
  push:
    branches-ignore:
      - master
      - release/**
  pull_request:
    branches:
      - develop
  workflow_dispatch:
    inputs:
      deploy_prod:
        description: 'Set to true to deploy to production'
        required: true
        default: 'false'

jobs:
  lint-and-test:
    name: Lint and Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Lint Code
        run: echo "Linting the code..."
      - name: Run Tests
        run: echo "Running tests..."

  lint-feature-branches:
    name: Lint Feature Branches
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/heads/feature/')
    steps:
      - uses: actions/checkout@v2
      - name: Lint Code
        run: echo "Linting the code..."

  build-and-deploy-dev:
    name: Build and Deploy to Development
    runs-on: ubuntu-latest
    needs: lint-and-test
    if: github.ref == 'refs/heads/develop' && github.event_name == 'push' || github.event_name == 'pull_request' && github.base_ref == 'refs/heads/develop'
    steps:
      - uses: actions/checkout@v2
      - name: Build Docker Image
        run: echo "Building Docker image for development..."
      - name: Deploy to Dev Environment
        run: echo "Deploying to development environment..."

  build-and-deploy-staging:
    name: Build and Deploy to Staging
    runs-on: ubuntu-latest
    needs: lint-and-test
    if: startsWith(github.ref, 'refs/heads/release/') && github.event_name == 'push'
    steps:
      - uses: actions/checkout@v2
      - name: Build Docker Image for Staging
        run: echo "Building Docker image for staging..."
      - name: Deploy to Staging Environment
        run: echo "Deploying to staging environment..."

  deploy-prod:
    name: Deploy to Production
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch' && github.event.inputs.deploy_prod == 'true'
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to Production Environment
        run: echo "Deploying to production environment..."